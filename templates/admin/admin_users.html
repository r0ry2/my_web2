{% extends "base.html" %}
{% block title %}Manage Users | Crochet Rory Store{% endblock %}

{% block content %}
<div style="max-width:900px; margin:40px auto; background:#fff0f6; padding:30px; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.1);">

  <h2 style="text-align:center; color:#e26fa7; margin-bottom:20px;">👥 Manage Users</h2>

  <!-- 🔍 Search & Filter -->
  <form method="get" action="{{ url_for('admin_users') }}" style="text-align:center; margin-bottom:20px;">
    <input type="text" name="search" value="{{ search }}" placeholder="Search by name or email..."
           style="padding:8px 12px; border-radius:10px; border:1px solid #ffd4e2; width:250px;">

    <select name="role" style="padding:8px 12px; border-radius:10px; border:1px solid #ffd4e2;">
      <option value="">All Roles</option>
      <option value="user" {% if role_filter == 'user' %}selected{% endif %}>Users</option>
      <option value="admin" {% if role_filter == 'admin' %}selected{% endif %}>Admins</option>
    </select>

    <button type="submit" style="background:#e26fa7; color:white; border:none; border-radius:10px; padding:8px 15px; cursor:pointer;">
      🔍 Search
    </button>
  </form>

  <!-- 🧾 Users Table -->
  <table style="width:100%; border-collapse:collapse; text-align:center;">
    <thead style="background-color:#ffe4ef;">
      <tr>
        <th style="padding:10px;">ID</th>
        <th style="padding:10px;">Username</th>
        <th style="padding:10px;">Email</th>
        <th style="padding:10px;">Role</th>
        <th style="padding:10px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr style="border-bottom:1px solid #f3c1d1;">
        <td>{{ user.id }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>
          {% if user.role == 'admin' %}
            <span style="color:#4caf50; font-weight:bold;">Admin</span>
          {% else %}
            <span style="color:#f48fb1; font-weight:bold;">User</span>
          {% endif %}
        </td>

        <td>
          {% if user.role == 'admin' and user.email != 'admin@store.com' %}
          <!-- Demote -->
          <form action="{{ url_for('demote_user', id=user.id) }}" method="POST" style="display:inline;">
            <button type="submit" style="background:#fbc02d; color:white; border:none; border-radius:8px; padding:6px 10px; cursor:pointer;">
              ⬇ Demote
            </button>
          </form>
          {% elif user.role == 'user' %}
          <!-- Promote -->
          <form action="{{ url_for('make_admin', id=user.id) }}" method="POST" style="display:inline;">
            <button type="submit" style="background:#4caf50; color:white; border:none; border-radius:8px; padding:6px 10px; cursor:pointer;">
              ⬆ Promote
            </button>
          </form>
          {% endif %}

          <!-- Delete -->
          <form action="{{ url_for('delete_user', id=user.id) }}" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this user?')" 
                    style="background:#f44336; color:white; border:none; border-radius:8px; padding:6px 10px; cursor:pointer;">
              🗑 Delete
            </button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="5" style="padding:15px;">No users found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- 🔙 Back Button -->
  <div style="text-align:center; margin-top:25px;">
    <a href="{{ url_for('admin_dashboard') }}" 
       style="background:#e26fa7; color:white; padding:10px 20px; border-radius:25px; text-decoration:none;">
       ⬅ Back to Admin Dashboard
    </a>
  </div>

</div>
{% endblock %}
